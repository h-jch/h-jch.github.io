<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java注解和反射笔记 | Kei's Blog</title><meta name=keywords content="java"><meta name=description content="1 注解 1.1 定义 Annotation是从JDK1.5开始引入的技术 作用 不是程序本身，可以对程序作出解释 可以被其他程序（编译器等）读取 格式 @注释名"><meta name=author content="kei"><link rel=canonical href=https://h-jch.github.io/posts/code/study-java-reflection/><link crossorigin=anonymous href=/assets/css/stylesheet.678b5c47efa744d2e0dd0d61101075e6aecdc9a0631e7ad8538f4ec0cca79273.css integrity="sha256-Z4tcR++nRNLg3Q1hEBB15q7NyaBjHnrYU49OwMynknM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://h-jch.github.io/images/avatar.png><link rel=icon type=image/png sizes=16x16 href=https://h-jch.github.io/images/avatar.png><link rel=icon type=image/png sizes=32x32 href=https://h-jch.github.io/images/avatar.png><link rel=apple-touch-icon href=https://h-jch.github.io/images/avatar.png><link rel=mask-icon href=https://h-jch.github.io/images/avatar.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Java注解和反射笔记"><meta property="og:description" content="1 注解 1.1 定义 Annotation是从JDK1.5开始引入的技术 作用 不是程序本身，可以对程序作出解释 可以被其他程序（编译器等）读取 格式 @注释名"><meta property="og:type" content="article"><meta property="og:url" content="https://h-jch.github.io/posts/code/study-java-reflection/"><meta property="og:image" content="https://h-jch.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-28T03:10:40+08:00"><meta property="article:modified_time" content="2020-07-28T03:10:40+08:00"><meta property="og:site_name" content="Kei's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://h-jch.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Java注解和反射笔记"><meta name=twitter:description content="1 注解 1.1 定义 Annotation是从JDK1.5开始引入的技术 作用 不是程序本身，可以对程序作出解释 可以被其他程序（编译器等）读取 格式 @注释名"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://h-jch.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Java注解和反射笔记","item":"https://h-jch.github.io/posts/code/study-java-reflection/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java注解和反射笔记","name":"Java注解和反射笔记","description":"1 注解 1.1 定义 Annotation是从JDK1.5开始引入的技术 作用 不是程序本身，可以对程序作出解释 可以被其他程序（编译器等）读取 格式 @注释名","keywords":["java"],"articleBody":"1 注解 1.1 定义 Annotation是从JDK1.5开始引入的技术\n作用\n不是程序本身，可以对程序作出解释 可以被其他程序（编译器等）读取 格式\n@注释名，可以添加一些数值 注解可以附加在package，class，method，field上面，可以通过反射机制实现对这些元数据的访问 1.2 内置注解 @Override：定义在java.lang.Override中，只适用于修饰方法，表示一个方法声明打算重写超类中的另一个方法声明 @Deprecated：定义在java.lang.Deprecated中，可以修饰方法，属性，类，表示不建议使用这样的元素，有更好的选择 @SuppressWarnings：定义在java.lang.SuppressWarnings中，用来抑制编译时的警告信息 1.3 元注解 元注解的作用是负责注解其他注解，Java定义了4个标注的meta-annotation类型\n@Target：用于描述注解的使用范围（类，方法，属性等） @Retention：表示需要在什么级别保存该注释信息，用于描述注解的生命周期 SOURCE \u003c CLASS \u003c RUNTIME @Documented：说明该注解将被包含在javadoc中 @Inherited：说明子类可以继承父类中的该注解 1.4 自定义注解 使用@interface自定义注解，自动继承java.lang.annotation.Annotation接口 其中的每个方法实际上是声明了配置参数，方法的名称就是参数的名称，返回值的类型就是参数的类型 用default来声明参数的默认值 如果只有一个参数成员，一般参数名为value，且定义为value后，使用时可以省略参数名value，直接写值 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Target(value = {ElementType.METHOD, ElementType.TYPE}) @Retention(value = RetentionPolicy.RUNTIME) @Documented @Inherited public @interface MyAnnotation { //注解的参数：参数类型+参数名() String name() default \"\";\t//默认为空 int age() default 0; int id() default -1;\t//默认值为-1，代表不存在 String[] jobs(); } 2 静态语言和动态语言 动态语言 在运行时可以改变其结构，新的函数、对象、代码可以被引进，已有的函数可以被删除或是其他结构上的变化 Object-C，C#，JavaScript，PHP，Python 静态语言 运行时结构不可改变 C，C++，Java Java不是动态语言，但是可以利用反射机制获得类似动态语言的特性\n3 反射 3.1 概述 反射机制允许程序在执行期间借助于Reflection API获得任何类的内部信息，并能直接操作任意对象的内部属性及方法\n1 Class c = Class.forName(\"java.lang.String\"); 加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象包含了完整的类的结构信息，通过这个类可以看到类的结构\n正常方式 引入需要的包类名称 —\u003e 通过new实例化 —\u003e 取得实例化对象 反射方式 实例化对象 —\u003e getClass()方法 —\u003e 得到完整的包类结构信息 3.2 Class类 对于每个类而言，jre都会为其保留一个不变的Class类型的对象。一个Class对象包含了特定某个结构的信息\nClass本身也是一个类 Class对象只能由系统建立对象 一个加载的类在JVM中只会有一个Class实例 一个Class对象对应的是一个加载到JVM中一个.class文件 每个类的实例都会记得自己是由哪个Class实例所生成的 Class类是Reflection的根源，针对任何想动态加载、运行的类，只有先获得相应的Class对象 3.3 获得反射对象 首先，哪些类型有Class对象\nclass：外部类，成员内部类，静态内部类，局部内部类，匿名内部类 interface：接口 []：数组 只要元素类型和维度一样，就是同一个Class，不管数据长度 enum：枚举 annotation：注解@interface primitive type：基本数据类型 void 获得Class对象的方法\n已知具体的类，通过类的class属性获取，这种方法最安全快速\n1 Class clazz = Person.class; 已知某个类的实例，调用该实例的getClass()方法获取Class对象\n1 Class clazz = persion.getClass(); 已知类的全类名，通过Class类的静态方法forName()获取，可能抛出异常\n1 Class clazz = Class.forName(\"com.hjc.pojo.User\"); 内置基本数据类型可以直接用类名.TYPE\n利用ClassLoader\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 public class Test { public static void main(String[] args) throws ClassNotFoundException { Person person = new Student(); System.out.println(person.name); //通过对象获得 Class c1 = person.getClass(); //通过forName获得 Class c2 = Class.forName(\"com.hjc.reflection.Student\"); //通过类名.class获得 Class c3 = Student.class; //基本数据类型 Class c4 = Integer.TYPE; //获得父类 Class c5 = c1.getSuperClass(); } } class Person { String name; //省略构造函数和set/get方法 } class Student extends Person { public Student() { this.name = \"student\"; } } class Teacher extends Person { public Teacher() { this.name = \"teacher\"; } } 3.4 类加载过程 当程序主动使用某个类时，如果该类还未被加载到内存中，则系统会通过三个步骤对该类进行初始化\n加载 将class文件字节码内容加载到内存中，并将这些静态数据转换成方法区的运行时数据结构，生成一个代表这个类的java.lang.Class对象 链接 将Java类的二进制代码合并到JVM的运行状态之中 验证：确保加载的类信息符合JVM规范，没有安全方面的问题 准备：正式为类变量（static）分配内存并设置类变量默认初始值，这些内存都在方法区中进行分配 解析：虚拟机常量池内的符号引用（常量名）替换为直接引用（地址） 初始化 执行类构造器()方法的过程 当初始化一个类的时候，如果发现父类还没有初始化，则要先触发父类的初始化 虚拟机会保证一个类的()方法在多线程环境中被正确加锁和同步 3.5 类初始化 什么时候会发生类初始化\n类的主动引用（一定会发生类的初始化) 当虚拟机启动，先初始化main方法所在的类 new一个类的对象 调用类的静态成员（除了final常量）和静态方法 使用java.lang.reflect包的方法对类进行反射调用 当初始化一个类，如果其父类没有被初始化，则会先初始化其父类 类的被动引用（不会发生类的初始化） 当访问一个静态域时，只有真正声明这个域的类才会被初始化 比如，通过子类引用父类的静态变量，不会导致子类初始化 通过数组定义类引用，不会触发此类的初始化 引用常量不会触发此类的初始化 常量在链接阶段就存入调用类的常量池中了 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 public class Test { static { System.out.println(\"Main类被加载\"); } public static void main(String[] args) throws ClassNotFoundException { //主动引用 B b = new B(); //反射 Class.forName(\"com.hjc.reflection.B\"); //B不会被加载，会加载A System.out.println(B.n); //B不被加载 B[] array = new B[10]; System.out.println(B.M); } } class A { static { System.out.println(\"父类被加载\"); } static int n = 2; } classs B extends A { static { System.out.println(\"子类被加载\"); m = 300; } static int m = 100; static final int M = 1; } 3.6 类加载器 类加载器的作用\n将class文件字节码内容加载到内存中，并将这些静态数据转换程方法区的运行时数据结构，在堆中生成一个代表这个类的java.lang.Class对象，作为方法区中类数据的访问入口 类缓存\n标准的JavaSE类加载器可以按要求查找类，但一旦某个类被加载到类加载器中，它将维持加载（缓存）一段时间，但JVM垃圾回收机制可以回收这些Class对象 类加载器\n引导类加载器 用C++编写，是JVM自带的类加载器，负责Java平台核心库，用来装载核心类库，该加载器无法直接获取 扩展类加载器 负责jre/lib/ext目录下的jar包装入工作库 系统类加载器 负责java -classpath下的jar包装入工作库，是最常用的加载器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public class Test { public static void main(String[] args) throws ClassNotFoundException { //获取系统类加载器 ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader(); System.out.println(systemClassLoader); //获取系统类加载器的父类，扩展类加载器 ClassLoader parent = systemClassLoader.getParent(); System.out.println(parent); //获取扩展类加载器的父类，引导类加载器，无法获取 parent = parent.getParent(); System.out.println(parent); //测试当前类是由哪个类加载器加载的 ClassLoader classLoader = Class.forName(\"com.hjc.reflection.Test\").getClassLoader(); System.out.println(ClassLoader); //测试jdk内置的类 classLoader = Class.forName(\"java.lang.Object\").getClassLoader(); System.out.println(ClassLoader); } } 3.7 获取运行时类的完整结构 获得了类的Class对象，那么我们就可以得到类的运行时信息\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 public class Test { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException { Class c = Class.forName(\"com.hjc.reflection.User\"); //获得类的名字 System.out.println(c.getName());\t//包名+类名 System.out.println(c.getSimpleName());\t//类名 //获得类的属性 Field[] fields = c.getFields();\t//只能得到public属性 for (Field field : fields) { System.out.println(field); } fields = c.getDeclaredFields();\t//可以得到全部属性 for (Field field : fields) { System.out.println(field); } //获得指定属性 Field name = c.getField(\"name\");\t//找不到，因为name是private System.out.println(name); Field name = c.getDeclaredField(\"name\");\t//可以找到 System.out.println(name); //获得类的方法 Method[] methods = c.getMethods();\t//获得本类及其父类的全部public方法 for (Method method : methods) { System.out.println(method); } methods = c.getDeclaredMethods();\t//获得本类的全部方法 for (Method method : methods) { System.out.println(method); } //获得类的指定方法 Method getName = c.getMethod(\"getName\", null);\t//方法名+参数 Method setName = c.getMethod(\"setName\", String.class); System.out.println(getName); System.out.println(setName); //获得类的构造器 Constructor[] constructors = c.getConstructors();\t//获得public for (Constructor constructor : constructors) { System.out.println(constructor); } constructors = c.getDeclaredConstructors();\t//获得全部 for (Constructor constructor : constructors) { System.out.println(constructor); } //获得指定构造器 Constructor declaredConstructor = c.getDeclaredConstructor(int.class, String.class, int.class); System.out.println(declaredConstructor); } } class User { private int id; private String name; private int age; //省略构造方法和set/get方法 } 3.8 动态创建对象执行方法 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class Test { public static void main(String[] args) throws ClassNotFoundException { Class c = Class.forName(\"com.hjc.reflection.User\"); //构造一个对象 User user = (User) c.newInstance();\t//本质上调用了类的无参构造器 System.out.println(user); //如果没有无参构造器，通过有参构造器创建对象 Constructor constructor = c.getDeclaredConstructor(int.class, String.class, int.class); User user = (User) constructor.newInstance(1, \"test\", 18); System.out.println(user); //反射调用方法 Method setName = c.getDeclaredMethod(\"setName\", String.class); setName.invoke(user, \"test1\");\t//invoke传递对象和方法参数值 System.out.println(user); //反射操作属性 Field name = c.getDeclaredField(\"name\"); //不能直接操作私有属性，需要关闭程序的安全检测 //调用属性或者方法的setAccessible(true) name.setAccessible(true); name.set(user, \"test2\"); System.out.println(user); } } 3.9 性能分析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 public class Test { //普通方式 public void test1() { User user = new User(); long startTime = System.currentTimeMillis(); for (int i = 0; i \u003c 1000000000; i++) { user.getName(); } long endTime = System.currentTimeMillis(); System.out.println(\"普通方式执行十亿次：\" + (endTime - startTime) + \"ms\"); } //反射方式 public void test2() throws NoSuchMethodException { User user = new User(); Class c = user.getClass(); Method getName = c.getDeclaredMethod(\"getName\", null); long startTime = System.currentTimeMillis(); for (int i = 0; i \u003c 1000000000; i++) { getName.invoke(user, null); } long endTime = System.currentTimeMillis(); System.out.println(\"反射方式执行十亿次：\" + (endTime - startTime) + \"ms\"); } //反射方式，关闭检测 public void test3() throws NoSuchMethodException { User user = new User(); Class c = user.getClass(); Method getName = c.getDeclaredMethod(\"getName\", null); getName.setAccessible(true); long startTime = System.currentTimeMillis(); for (int i = 0; i \u003c 1000000000; i++) { getName.invoke(user, null); } long endTime = System.currentTimeMillis(); System.out.println(\"关闭检测后，反射方式执行十亿次：\" + (endTime - startTime) + \"ms\"); } public static void main(String[] args) { test1(); test2(); test3(); } } 3.10 反射操作泛型 Java采用泛型擦除的机制来引入泛型，Java中的泛型仅仅是给编译器javac使用的，确保数据的安全性和免去强制类型转换问题，但是一旦编译完成，所有和泛型有关的类型全部擦除\n为了通过反射操作泛型，Java引入了几个类\nParameterizedType：表示一种参数化类型，如Collection GenericArrayType：表示一种元素类型是参数化类型或者类型变量的数组类型 TypeVariable：各种类型变量的公共父接口 WildcardType：代表一种通配符类型表达式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 public class Test { public void test1(Map\u003cString, User\u003e map, List\u003cUser\u003e list) { System.out.println(\"test1\"); } public Map\u003cString, User\u003e test2() { System.out.println(\"test2\"); return null; } public static void main(String[] args) { Method method = Test.class.getMethod(\"test1\", Map.class, List.class); Type[] types = method.getGenericParameterTypes(); for (Type type : types) { System.out.println(type); if (type instanceof ParameterizedType) { Type[] actualTypes = ((ParameterizedType) type).getActualTypeArguments(); for (Type actualType : actualTypes) { System.out.println(actualType); } } } method = Test.class.getMethod(\"test2\", null); Type returnType = method.getGenericReturnType(); System.out.println(resultType); if (returnType instanceof ParameterizedType) { Type[] actualTypes = ((ParameterizedType) returnType).getActualTypeArguments(); for (Type actualType : actualTypes) { System.out.println(actualType); } } } } 3.11 反射操作注解 很多框架都是通过反射获取注解信息，来帮我们解决了很多事情\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 public class Test { public static void main(String[] args) throws ClassNotFoundException { Class c = Class.forName(\"com.hjc.reflection.Student\"); //通过反射获得注解 Annotation[] annotations = c.getAnnotations(); for (Annotation annotation : annotations) { System.out.println(annotation); } //获得注解的值 Table1 table1 = (Table1) c.getAnnotation(Table1.class); String value = table1.value(); System.out.println(value); //获得指定的注解 Field f = c.getDeclaredField(\"name\"); Field1 f1 = f.getAnnotation(Field1.class); System.out.println(f1.columnName()); System.out.println(f1.type()); System.out.println(f1.length()); } } @Table1(\"db_student\") class Student { @Field1(columnName = \"db_id\", type = \"int\", length = 10) private int id; @Field1(columnName = \"db_name\", type = \"varchar\", length = 3) private String name; @Field1(columnName = \"db_age\", type = \"int\", length = 10) private int age; //省略构造器和set/get方法 } @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @interface Table1 { String value(); } @Target(ElementType.FIELD) @Retention(RetentionPolicy.RUNTIME) @interface Field1 { String columnName(); String type(); int length(); } ","wordCount":"4824","inLanguage":"en","datePublished":"2020-07-28T03:10:40+08:00","dateModified":"2020-07-28T03:10:40+08:00","author":[{"@type":"Person","name":"kei"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://h-jch.github.io/posts/code/study-java-reflection/"},"publisher":{"@type":"Organization","name":"Kei's Blog","logo":{"@type":"ImageObject","url":"https://h-jch.github.io/images/avatar.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://h-jch.github.io accesskey=h title="Kei's Blog (Alt + H)"><img src=https://h-jch.github.io/images/avatar.png alt aria-label=logo height=35>Kei's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://h-jch.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://h-jch.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://h-jch.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://h-jch.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Java注解和反射笔记</h1><div class=post-meta><span title='2020-07-28 03:10:40 +0800 CST'>2020-07-28</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;4824 words&nbsp;·&nbsp;kei</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-%e6%b3%a8%e8%a7%a3 aria-label="1 注解">1 注解</a><ul><li><a href=#11-%e5%ae%9a%e4%b9%89 aria-label="1.1 定义">1.1 定义</a></li><li><a href=#12-%e5%86%85%e7%bd%ae%e6%b3%a8%e8%a7%a3 aria-label="1.2 内置注解">1.2 内置注解</a></li><li><a href=#13-%e5%85%83%e6%b3%a8%e8%a7%a3 aria-label="1.3 元注解">1.3 元注解</a></li><li><a href=#14-%e8%87%aa%e5%ae%9a%e4%b9%89%e6%b3%a8%e8%a7%a3 aria-label="1.4 自定义注解">1.4 自定义注解</a></li></ul></li><li><a href=#2-%e9%9d%99%e6%80%81%e8%af%ad%e8%a8%80%e5%92%8c%e5%8a%a8%e6%80%81%e8%af%ad%e8%a8%80 aria-label="2 静态语言和动态语言">2 静态语言和动态语言</a></li><li><a href=#3-%e5%8f%8d%e5%b0%84 aria-label="3 反射">3 反射</a><ul><li><a href=#31-%e6%a6%82%e8%bf%b0 aria-label="3.1 概述">3.1 概述</a></li><li><a href=#32-class%e7%b1%bb aria-label="3.2 Class类">3.2 Class类</a></li><li><a href=#33-%e8%8e%b7%e5%be%97%e5%8f%8d%e5%b0%84%e5%af%b9%e8%b1%a1 aria-label="3.3 获得反射对象">3.3 获得反射对象</a></li><li><a href=#34-%e7%b1%bb%e5%8a%a0%e8%bd%bd%e8%bf%87%e7%a8%8b aria-label="3.4 类加载过程">3.4 类加载过程</a></li><li><a href=#35-%e7%b1%bb%e5%88%9d%e5%a7%8b%e5%8c%96 aria-label="3.5 类初始化">3.5 类初始化</a></li><li><a href=#36-%e7%b1%bb%e5%8a%a0%e8%bd%bd%e5%99%a8 aria-label="3.6 类加载器">3.6 类加载器</a></li><li><a href=#37-%e8%8e%b7%e5%8f%96%e8%bf%90%e8%a1%8c%e6%97%b6%e7%b1%bb%e7%9a%84%e5%ae%8c%e6%95%b4%e7%bb%93%e6%9e%84 aria-label="3.7 获取运行时类的完整结构">3.7 获取运行时类的完整结构</a></li><li><a href=#38-%e5%8a%a8%e6%80%81%e5%88%9b%e5%bb%ba%e5%af%b9%e8%b1%a1%e6%89%a7%e8%a1%8c%e6%96%b9%e6%b3%95 aria-label="3.8 动态创建对象执行方法">3.8 动态创建对象执行方法</a></li><li><a href=#39-%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90 aria-label="3.9 性能分析">3.9 性能分析</a></li><li><a href=#310-%e5%8f%8d%e5%b0%84%e6%93%8d%e4%bd%9c%e6%b3%9b%e5%9e%8b aria-label="3.10 反射操作泛型">3.10 反射操作泛型</a></li><li><a href=#311-%e5%8f%8d%e5%b0%84%e6%93%8d%e4%bd%9c%e6%b3%a8%e8%a7%a3 aria-label="3.11 反射操作注解">3.11 反射操作注解</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=1-注解>1 注解<a hidden class=anchor aria-hidden=true href=#1-注解>#</a></h2><h3 id=11-定义>1.1 定义<a hidden class=anchor aria-hidden=true href=#11-定义>#</a></h3><p>Annotation是从JDK1.5开始引入的技术</p><p>作用</p><ul><li>不是程序本身，可以对程序作出解释</li><li>可以被其他程序（编译器等）读取</li></ul><p>格式</p><ul><li>@注释名，可以添加一些数值</li><li>注解可以附加在package，class，method，field上面，可以通过反射机制实现对这些元数据的访问</li></ul><h3 id=12-内置注解>1.2 内置注解<a hidden class=anchor aria-hidden=true href=#12-内置注解>#</a></h3><ul><li>@Override：定义在java.lang.Override中，只适用于修饰方法，表示一个方法声明打算重写超类中的另一个方法声明</li><li>@Deprecated：定义在java.lang.Deprecated中，可以修饰方法，属性，类，表示不建议使用这样的元素，有更好的选择</li><li>@SuppressWarnings：定义在java.lang.SuppressWarnings中，用来抑制编译时的警告信息</li></ul><h3 id=13-元注解>1.3 元注解<a hidden class=anchor aria-hidden=true href=#13-元注解>#</a></h3><p>元注解的作用是负责注解其他注解，Java定义了4个标注的meta-annotation类型</p><ul><li>@Target：用于描述注解的使用范围（类，方法，属性等）</li><li>@Retention：表示需要在什么级别保存该注释信息，用于描述注解的生命周期<ul><li>SOURCE &lt; CLASS &lt; RUNTIME</li></ul></li><li>@Documented：说明该注解将被包含在javadoc中</li><li>@Inherited：说明子类可以继承父类中的该注解</li></ul><h3 id=14-自定义注解>1.4 自定义注解<a hidden class=anchor aria-hidden=true href=#14-自定义注解>#</a></h3><ul><li>使用@interface自定义注解，自动继承java.lang.annotation.Annotation接口</li><li>其中的每个方法实际上是声明了配置参数，方法的名称就是参数的名称，返回值的类型就是参数的类型</li><li>用default来声明参数的默认值</li><li>如果只有一个参数成员，一般参数名为value，且定义为value后，使用时可以省略参数名value，直接写值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Target</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=o>{</span><span class=n>ElementType</span><span class=o>.</span><span class=na>METHOD</span><span class=o>,</span> <span class=n>ElementType</span><span class=o>.</span><span class=na>TYPE</span><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Documented</span>
</span></span><span class=line><span class=cl><span class=nd>@Inherited</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=nd>@interface</span> <span class=n>MyAnnotation</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//注解的参数：参数类型+参数名()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=nf>name</span><span class=o>()</span> <span class=k>default</span> <span class=s>&#34;&#34;</span><span class=o>;</span>	<span class=c1>//默认为空
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>age</span><span class=o>()</span> <span class=k>default</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>id</span><span class=o>()</span> <span class=k>default</span> <span class=o>-</span><span class=n>1</span><span class=o>;</span>	<span class=c1>//默认值为-1，代表不存在
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=n>String</span><span class=o>[]</span> <span class=nf>jobs</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=2-静态语言和动态语言>2 静态语言和动态语言<a hidden class=anchor aria-hidden=true href=#2-静态语言和动态语言>#</a></h2><ul><li>动态语言<ul><li>在运行时可以改变其结构，新的函数、对象、代码可以被引进，已有的函数可以被删除或是其他结构上的变化</li><li>Object-C，C#，JavaScript，PHP，Python</li></ul></li><li>静态语言<ul><li>运行时结构不可改变</li><li>C，C++，Java</li></ul></li></ul><p>Java不是动态语言，但是可以利用反射机制获得类似动态语言的特性</p><h2 id=3-反射>3 反射<a hidden class=anchor aria-hidden=true href=#3-反射>#</a></h2><h3 id=31-概述>3.1 概述<a hidden class=anchor aria-hidden=true href=#31-概述>#</a></h3><p>反射机制允许程序在执行期间借助于Reflection API获得任何类的内部信息，并能直接操作任意对象的内部属性及方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;java.lang.String&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象包含了完整的类的结构信息，通过这个类可以看到类的结构</p><ul><li>正常方式<ul><li>引入需要的包类名称 &mdash;> 通过new实例化 &mdash;> 取得实例化对象</li></ul></li><li>反射方式<ul><li>实例化对象 &mdash;> getClass()方法 &mdash;> 得到完整的包类结构信息</li></ul></li></ul><h3 id=32-class类>3.2 Class类<a hidden class=anchor aria-hidden=true href=#32-class类>#</a></h3><p>对于每个类而言，jre都会为其保留一个不变的Class类型的对象。一个Class对象包含了特定某个结构的信息</p><ul><li>Class本身也是一个类</li><li>Class对象只能由系统建立对象</li><li>一个加载的类在JVM中只会有一个Class实例</li><li>一个Class对象对应的是一个加载到JVM中一个.class文件</li><li>每个类的实例都会记得自己是由哪个Class实例所生成的</li><li>Class类是Reflection的根源，针对任何想动态加载、运行的类，只有先获得相应的Class对象</li></ul><h3 id=33-获得反射对象>3.3 获得反射对象<a hidden class=anchor aria-hidden=true href=#33-获得反射对象>#</a></h3><p>首先，哪些类型有Class对象</p><ul><li>class：外部类，成员内部类，静态内部类，局部内部类，匿名内部类</li><li>interface：接口</li><li>[]：数组<ul><li>只要元素类型和维度一样，就是同一个Class，不管数据长度</li></ul></li><li>enum：枚举</li><li>annotation：注解@interface</li><li>primitive type：基本数据类型</li><li>void</li></ul><p>获得Class对象的方法</p><ul><li><p>已知具体的类，通过类的class属性获取，这种方法最安全快速</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>Person</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>已知某个类的实例，调用该实例的getClass()方法获取Class对象</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>persion</span><span class=o>.</span><span class=na>getClass</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>已知类的全类名，通过Class类的静态方法forName()获取，可能抛出异常</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.pojo.User&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>内置基本数据类型可以直接用类名.TYPE</p></li><li><p>利用ClassLoader</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Person</span> <span class=n>person</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Student</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>person</span><span class=o>.</span><span class=na>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//通过对象获得
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Class</span> <span class=n>c1</span> <span class=o>=</span> <span class=n>person</span><span class=o>.</span><span class=na>getClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//通过forName获得
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Class</span> <span class=n>c2</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.reflection.Student&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//通过类名.class获得
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Class</span> <span class=n>c3</span> <span class=o>=</span> <span class=n>Student</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//基本数据类型
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Class</span> <span class=n>c4</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>TYPE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得父类
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Class</span> <span class=n>c5</span> <span class=o>=</span> <span class=n>c1</span><span class=o>.</span><span class=na>getSuperClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Person</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//省略构造函数和set/get方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Student</span> <span class=kd>extends</span> <span class=n>Person</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Student</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=s>&#34;student&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Teacher</span> <span class=kd>extends</span> <span class=n>Person</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Teacher</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=s>&#34;teacher&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=34-类加载过程>3.4 类加载过程<a hidden class=anchor aria-hidden=true href=#34-类加载过程>#</a></h3><p>当程序主动使用某个类时，如果该类还未被加载到内存中，则系统会通过三个步骤对该类进行初始化</p><p><img loading=lazy src=%e7%b1%bb%e5%8a%a0%e8%bd%bd.png alt></p><ul><li>加载<ul><li>将class文件字节码内容加载到内存中，并将这些静态数据转换成方法区的运行时数据结构，生成一个代表这个类的java.lang.Class对象</li></ul></li><li>链接<ul><li>将Java类的二进制代码合并到JVM的运行状态之中<ul><li>验证：确保加载的类信息符合JVM规范，没有安全方面的问题</li><li>准备：正式为类变量（static）分配内存并设置类变量默认初始值，这些内存都在方法区中进行分配</li><li>解析：虚拟机常量池内的符号引用（常量名）替换为直接引用（地址）</li></ul></li></ul></li><li>初始化<ul><li>执行类构造器&lt;clinit>()方法的过程</li><li>当初始化一个类的时候，如果发现父类还没有初始化，则要先触发父类的初始化</li><li>虚拟机会保证一个类的&lt;clinit>()方法在多线程环境中被正确加锁和同步</li></ul></li></ul><h3 id=35-类初始化>3.5 类初始化<a hidden class=anchor aria-hidden=true href=#35-类初始化>#</a></h3><p>什么时候会发生类初始化</p><ul><li>类的主动引用（一定会发生类的初始化)<ul><li>当虚拟机启动，先初始化main方法所在的类</li><li>new一个类的对象</li><li>调用类的静态成员（除了final常量）和静态方法</li><li>使用java.lang.reflect包的方法对类进行反射调用</li><li>当初始化一个类，如果其父类没有被初始化，则会先初始化其父类</li></ul></li><li>类的被动引用（不会发生类的初始化）<ul><li>当访问一个静态域时，只有真正声明这个域的类才会被初始化<ul><li>比如，通过子类引用父类的静态变量，不会导致子类初始化</li></ul></li><li>通过数组定义类引用，不会触发此类的初始化</li><li>引用常量不会触发此类的初始化<ul><li>常量在链接阶段就存入调用类的常量池中了</li></ul></li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Main类被加载&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//主动引用
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>B</span> <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>B</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//反射
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.reflection.B&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//B不会被加载，会加载A
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>B</span><span class=o>.</span><span class=na>n</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//B不被加载
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>B</span><span class=o>[]</span> <span class=n>array</span> <span class=o>=</span> <span class=k>new</span> <span class=n>B</span><span class=o>[</span><span class=n>10</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>B</span><span class=o>.</span><span class=na>M</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>A</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;父类被加载&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classs</span> <span class=n>B</span> <span class=kd>extends</span> <span class=n>A</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;子类被加载&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>300</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>int</span> <span class=n>m</span> <span class=o>=</span> <span class=n>100</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>M</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=36-类加载器>3.6 类加载器<a hidden class=anchor aria-hidden=true href=#36-类加载器>#</a></h3><p>类加载器的作用</p><ul><li>将class文件字节码内容加载到内存中，并将这些静态数据转换程方法区的运行时数据结构，在堆中生成一个代表这个类的java.lang.Class对象，作为方法区中类数据的访问入口</li></ul><p>类缓存</p><ul><li>标准的JavaSE类加载器可以按要求查找类，但一旦某个类被加载到类加载器中，它将维持加载（缓存）一段时间，但JVM垃圾回收机制可以回收这些Class对象</li></ul><p><img loading=lazy src=%e7%b1%bb%e7%bc%96%e8%af%91%e8%a3%85%e8%bd%bd%e8%a7%a3%e9%87%8a%e8%bf%90%e8%a1%8c.png alt></p><p>类加载器</p><ul><li>引导类加载器<ul><li>用C++编写，是JVM自带的类加载器，负责Java平台核心库，用来装载核心类库，该加载器无法直接获取</li></ul></li><li>扩展类加载器<ul><li>负责jre/lib/ext目录下的jar包装入工作库</li></ul></li><li>系统类加载器<ul><li>负责java -classpath下的jar包装入工作库，是最常用的加载器</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//获取系统类加载器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ClassLoader</span> <span class=n>systemClassLoader</span> <span class=o>=</span> <span class=n>ClassLoader</span><span class=o>.</span><span class=na>getSystemClassLoader</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>systemClassLoader</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获取系统类加载器的父类，扩展类加载器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ClassLoader</span> <span class=n>parent</span> <span class=o>=</span> <span class=n>systemClassLoader</span><span class=o>.</span><span class=na>getParent</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>parent</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获取扩展类加载器的父类，引导类加载器，无法获取
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>parent</span> <span class=o>=</span> <span class=n>parent</span><span class=o>.</span><span class=na>getParent</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>parent</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//测试当前类是由哪个类加载器加载的
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ClassLoader</span> <span class=n>classLoader</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.reflection.Test&#34;</span><span class=o>).</span><span class=na>getClassLoader</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ClassLoader</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//测试jdk内置的类
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>classLoader</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;java.lang.Object&#34;</span><span class=o>).</span><span class=na>getClassLoader</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ClassLoader</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=37-获取运行时类的完整结构>3.7 获取运行时类的完整结构<a hidden class=anchor aria-hidden=true href=#37-获取运行时类的完整结构>#</a></h3><p>获得了类的Class对象，那么我们就可以得到类的运行时信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span><span class=o>,</span> <span class=n>NoSuchFieldException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.reflection.User&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得类的名字
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>c</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>	<span class=c1>//包名+类名
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>c</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>());</span>	<span class=c1>//类名
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得类的属性
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Field</span><span class=o>[]</span> <span class=n>fields</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getFields</span><span class=o>();</span>	<span class=c1>//只能得到public属性
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>Field</span> <span class=n>field</span> <span class=o>:</span> <span class=n>fields</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>field</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>fields</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredFields</span><span class=o>();</span>	<span class=c1>//可以得到全部属性
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>Field</span> <span class=n>field</span> <span class=o>:</span> <span class=n>fields</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>field</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得指定属性
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Field</span> <span class=n>name</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getField</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>	<span class=c1>//找不到，因为name是private
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>Field</span> <span class=n>name</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredField</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>	<span class=c1>//可以找到
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得类的方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Method</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getMethods</span><span class=o>();</span>	<span class=c1>//获得本类及其父类的全部public方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>Method</span> <span class=n>method</span> <span class=o>:</span> <span class=n>methods</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>method</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>methods</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredMethods</span><span class=o>();</span>	<span class=c1>//获得本类的全部方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>Method</span> <span class=n>method</span> <span class=o>:</span> <span class=n>methods</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>method</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得类的指定方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Method</span> <span class=n>getName</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;getName&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>	<span class=c1>//方法名+参数
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Method</span> <span class=n>setName</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;setName&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>getName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>setName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得类的构造器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Constructor</span><span class=o>[]</span> <span class=n>constructors</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getConstructors</span><span class=o>();</span>	<span class=c1>//获得public
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>Constructor</span> <span class=n>constructor</span> <span class=o>:</span> <span class=n>constructors</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>constructor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>constructors</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredConstructors</span><span class=o>();</span>		<span class=c1>//获得全部
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>Constructor</span> <span class=n>constructor</span> <span class=o>:</span> <span class=n>constructors</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>constructor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得指定构造器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Constructor</span> <span class=n>declaredConstructor</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>(</span><span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>declaredConstructor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>User</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>age</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//省略构造方法和set/get方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=38-动态创建对象执行方法>3.8 动态创建对象执行方法<a hidden class=anchor aria-hidden=true href=#38-动态创建对象执行方法>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.reflection.User&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//构造一个对象
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>User</span> <span class=n>user</span> <span class=o>=</span> <span class=o>(</span><span class=n>User</span><span class=o>)</span> <span class=n>c</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>	<span class=c1>//本质上调用了类的无参构造器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//如果没有无参构造器，通过有参构造器创建对象
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Constructor</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>(</span><span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>User</span> <span class=n>user</span> <span class=o>=</span> <span class=o>(</span><span class=n>User</span><span class=o>)</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=s>&#34;test&#34;</span><span class=o>,</span> <span class=n>18</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//反射调用方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Method</span> <span class=n>setName</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredMethod</span><span class=o>(</span><span class=s>&#34;setName&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>setName</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>user</span><span class=o>,</span> <span class=s>&#34;test1&#34;</span><span class=o>);</span>	<span class=c1>//invoke传递对象和方法参数值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//反射操作属性
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Field</span> <span class=n>name</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredField</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//不能直接操作私有属性，需要关闭程序的安全检测
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//调用属性或者方法的setAccessible(true)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>name</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>user</span><span class=o>,</span> <span class=s>&#34;test2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=39-性能分析>3.9 性能分析<a hidden class=anchor aria-hidden=true href=#39-性能分析>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//普通方式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test1</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>User</span> <span class=n>user</span> <span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>startTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>1000000000</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>user</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>endTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;普通方式执行十亿次：&#34;</span> <span class=o>+</span> <span class=o>(</span><span class=n>endTime</span> <span class=o>-</span> <span class=n>startTime</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;ms&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//反射方式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test2</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>NoSuchMethodException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>User</span> <span class=n>user</span> <span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>user</span><span class=o>.</span><span class=na>getClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>getName</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredMethod</span><span class=o>(</span><span class=s>&#34;getName&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>startTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>1000000000</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>getName</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>user</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>endTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;反射方式执行十亿次：&#34;</span> <span class=o>+</span> <span class=o>(</span><span class=n>endTime</span> <span class=o>-</span> <span class=n>startTime</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;ms&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//反射方式，关闭检测
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test3</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>NoSuchMethodException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>User</span> <span class=n>user</span> <span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>user</span><span class=o>.</span><span class=na>getClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>getName</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredMethod</span><span class=o>(</span><span class=s>&#34;getName&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>getName</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>startTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>1000000000</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>getName</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>user</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>endTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;关闭检测后，反射方式执行十亿次：&#34;</span> <span class=o>+</span> <span class=o>(</span><span class=n>endTime</span> <span class=o>-</span> <span class=n>startTime</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;ms&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test1</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>test2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>test3</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=310-反射操作泛型>3.10 反射操作泛型<a hidden class=anchor aria-hidden=true href=#310-反射操作泛型>#</a></h3><p>Java采用泛型擦除的机制来引入泛型，Java中的泛型仅仅是给编译器javac使用的，确保数据的安全性和免去强制类型转换问题，但是一旦编译完成，所有和泛型有关的类型全部擦除</p><p>为了通过反射操作泛型，Java引入了几个类</p><ul><li>ParameterizedType：表示一种参数化类型，如Collection&lt;String></li><li>GenericArrayType：表示一种元素类型是参数化类型或者类型变量的数组类型</li><li>TypeVariable：各种类型变量的公共父接口</li><li>WildcardType：代表一种通配符类型表达式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test1</span><span class=o>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>User</span><span class=o>&gt;</span> <span class=n>map</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=n>list</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;test1&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>User</span><span class=o>&gt;</span> <span class=nf>test2</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;test2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;test1&#34;</span><span class=o>,</span> <span class=n>Map</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>List</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Type</span><span class=o>[]</span> <span class=n>types</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>getGenericParameterTypes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Type</span> <span class=n>type</span> <span class=o>:</span> <span class=n>types</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>type</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>type</span> <span class=k>instanceof</span> <span class=n>ParameterizedType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Type</span><span class=o>[]</span> <span class=n>actualTypes</span> <span class=o>=</span> <span class=o>((</span><span class=n>ParameterizedType</span><span class=o>)</span> <span class=n>type</span><span class=o>).</span><span class=na>getActualTypeArguments</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=o>(</span><span class=n>Type</span> <span class=n>actualType</span> <span class=o>:</span> <span class=n>actualTypes</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>actualType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>method</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;test2&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Type</span> <span class=n>returnType</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>getGenericReturnType</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>resultType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>returnType</span> <span class=k>instanceof</span> <span class=n>ParameterizedType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Type</span><span class=o>[]</span> <span class=n>actualTypes</span> <span class=o>=</span> <span class=o>((</span><span class=n>ParameterizedType</span><span class=o>)</span> <span class=n>returnType</span><span class=o>).</span><span class=na>getActualTypeArguments</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=n>Type</span> <span class=n>actualType</span> <span class=o>:</span> <span class=n>actualTypes</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>actualType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=311-反射操作注解>3.11 反射操作注解<a hidden class=anchor aria-hidden=true href=#311-反射操作注解>#</a></h3><p>很多框架都是通过反射获取注解信息，来帮我们解决了很多事情</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.hjc.reflection.Student&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//通过反射获得注解
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Annotation</span><span class=o>[]</span> <span class=n>annotations</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getAnnotations</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Annotation</span> <span class=n>annotation</span> <span class=o>:</span> <span class=n>annotations</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>annotation</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得注解的值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Table1</span> <span class=n>table1</span> <span class=o>=</span> <span class=o>(</span><span class=n>Table1</span><span class=o>)</span> <span class=n>c</span><span class=o>.</span><span class=na>getAnnotation</span><span class=o>(</span><span class=n>Table1</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>value</span> <span class=o>=</span> <span class=n>table1</span><span class=o>.</span><span class=na>value</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//获得指定的注解
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Field</span> <span class=n>f</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getDeclaredField</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Field1</span> <span class=n>f1</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=na>getAnnotation</span><span class=o>(</span><span class=n>Field1</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>f1</span><span class=o>.</span><span class=na>columnName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>f1</span><span class=o>.</span><span class=na>type</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>f1</span><span class=o>.</span><span class=na>length</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Table1</span><span class=o>(</span><span class=s>&#34;db_student&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Student</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Field1</span><span class=o>(</span><span class=n>columnName</span> <span class=o>=</span> <span class=s>&#34;db_id&#34;</span><span class=o>,</span> <span class=n>type</span> <span class=o>=</span> <span class=s>&#34;int&#34;</span><span class=o>,</span> <span class=n>length</span> <span class=o>=</span> <span class=n>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Field1</span><span class=o>(</span><span class=n>columnName</span> <span class=o>=</span> <span class=s>&#34;db_name&#34;</span><span class=o>,</span> <span class=n>type</span> <span class=o>=</span> <span class=s>&#34;varchar&#34;</span><span class=o>,</span> <span class=n>length</span> <span class=o>=</span> <span class=n>3</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Field1</span><span class=o>(</span><span class=n>columnName</span> <span class=o>=</span> <span class=s>&#34;db_age&#34;</span><span class=o>,</span> <span class=n>type</span> <span class=o>=</span> <span class=s>&#34;int&#34;</span><span class=o>,</span> <span class=n>length</span> <span class=o>=</span> <span class=n>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>age</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>//省略构造器和set/get方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Target</span><span class=o>(</span><span class=n>ElementType</span><span class=o>.</span><span class=na>TYPE</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@interface</span> <span class=n>Table1</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>value</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Target</span><span class=o>(</span><span class=n>ElementType</span><span class=o>.</span><span class=na>FIELD</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@interface</span> <span class=n>Field1</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>columnName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>type</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://h-jch.github.io/tags/java/>java</a></li></ul><nav class=paginav><a class=prev href=https://h-jch.github.io/posts/code/css_selector/><span class=title>« Prev</span><br><span>css中的选择器</span></a>
<a class=next href=https://h-jch.github.io/posts/code/study-java-thread/><span class=title>Next »</span><br><span>Java多线程笔记</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://h-jch.github.io>Kei's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>